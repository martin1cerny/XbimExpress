(*
Copyright by:
BIM Academy, Northumbria University, 2015

License: Creative Commons Attribution 4.0 International Public License
(https://creativecommons.org/licenses/by/4.0/legalcode)

This work is part of xBIM Toolkit (https://github.com/xBimTeam/)

Contents:
Object model for COBie 2.4 in form of EXPRESS definitions based on COBie Responsibility Matrix. It reflects 
all relations in between different data objects and makes it possible to handle COBie data as an graph structure
rather than tabular spreadsheet data with weak name based references. COBie 2.4 definition is based on Facility Handower
Model View Definition of IFC4 which is defined as an EXPRESS as well. However, definition in this file is far more simple
and therefore easier to work with once data is extracted/converted from IFC4 data. It should also be possible to transpose
data in between spreadsheet representation and STEP representation of the data. 

Developed by:
Martin Cerny (martin.cerny@northumbria.ac.uk)
*)

SCHEMA COBIE_EXPRESS;

TYPE SpatialDivision = SELECT
	(Site
	,Facility
	,Floor
	,Space);
END_TYPE;

TYPE AttributeValue = SELECT
	(DateTimeValue
	,StringValue
	,IntegerValue
	,FloatValue
	,BooleanValue);
END_TYPE;

TYPE StringValue = STRING;
END_TYPE;

TYPE IntegerValue = INTEGER;
END_TYPE;

TYPE FloatValue = REAL;
END_TYPE;

TYPE BooleanValue = BOOLEAN;
END_TYPE;

TYPE DateTimeValue = STRING;
END_TYPE;

ENTITY Phase
	Name: STRING;
	Project: Project;
END_ENTITY;

ENTITY ExternalSystem
	Name: STRING;
END_ENTITY;

ENTITY CreatedInfo
	CreatedBy: Contact;
	CreatedOn: DateTimeValue;
END_ENTITY;

ENTITY ReferencedObject
  ABSTRACT SUPERTYPE OF (ONEOF
  (Asset, Contact, Assembly, Connection, Spare, Resource, Job, Impact, Document, Attribute, Coordinate, Issue));
	Created: CreatedInfo;
	ExternalId: OPTIONAL STRING;
	ExternalSystem: OPTIONAL ExternalSystem;
	ExternalObject: OPTIONAL STRING;
END_ENTITY;

ENTITY Contact
  SUBTYPE OF (ReferencedObject);
	Email: STRING;
	Category: Role;
	Company: STRING;
	Phone: STRING;
	Department: OPTIONAL STRING;
	OrganizationCode: OPTIONAL STRING;
	GivenName: OPTIONAL STRING;
	FamilyName: OPTIONAL STRING;
	Street: OPTIONAL STRING;
	PostalBox: OPTIONAL STRING;
	Town: OPTIONAL STRING;
	StateRegion: OPTIONAL STRING;
	PostalCode: OPTIONAL STRING;
	Country: OPTIONAL STRING;
END_ENTITY;

ENTITY Asset
  ABSTRACT SUPERTYPE OF (ONEOF (Facility, Floor, Space, Zone, @Type, Component, System))
  SUBTYPE OF (ReferencedObject);
	Name: STRING;
	Description: OPTIONAL STRING;
	Category: LIST [1:?] OF Category;
    Impacts: OPTIONAL LIST [0:?] OF Impact;
    Documents: OPTIONAL LIST [0:?] OF Document;
    Attributes: OPTIONAL LIST [0:?] OF Attribute;
  INVERSE
    CausingIssues: SET [0:?] OF Issue FOR Causing;
    AffectedBy: SET [0:?] OF Issue FOR Affected;
  UNIQUE
	UR1: Name;
END_ENTITY;

ENTITY Facility
 SUBTYPE OF (Asset);
	LinearUnits: LinearUnit;
	AreaUnits: AreaUnit;
	VolumeUnits: VolumeUnit;
	CurrencyUnit: CurrencyUnit;
	AreaMeasurement: STRING;
	Project: Project;
	Site: Site;
	Phase: OPTIONAL Phase;
  INVERSE
    Floors: SET [1:?] OF Floor FOR Facility;
END_ENTITY;

ENTITY Project
	Name: STRING;
	Description: OPTIONAL STRING;
	ExternalObject: OPTIONAL STRING;
	ExternalId: OPTIONAL STRING;
  INVERSE
    Phases: SET [0:?] OF Phase FOR Project;
    Facilities: SET [0:?] OF Facility FOR Project;
END_ENTITY;

ENTITY Site
	Name: STRING;
	Description: OPTIONAL STRING;
	ExternalObject: OPTIONAL STRING;
	ExternalId: OPTIONAL STRING;
  INVERSE
    Facilities: SET [0:?] OF Facility FOR Site;
END_ENTITY;

ENTITY Floor
 SUBTYPE OF (Asset);
	Elevation: OPTIONAL REAL;
	Height: OPTIONAL REAL;
	Facility: Facility;
  INVERSE
    Spaces: SET [0:?] OF Space FOR Floor;
END_ENTITY;

ENTITY Space
 SUBTYPE OF (Asset);
	RoomTag: OPTIONAL STRING;
	UsableHeight: OPTIONAL REAL;
	GrossArea: OPTIONAL REAL;
	NetArea: OPTIONAL REAL;
	Floor: Floor;
  INVERSE
    Components: SET [0:?] OF Component FOR Space;
	InZones: SET [0:?] OF Zone FOR Spaces;
END_ENTITY; 

ENTITY Zone
 SUBTYPE OF (Asset);
	Spaces: LIST [0:?] OF Space;
END_ENTITY; 

ENTITY @Type
 SUBTYPE OF (Asset);
	AssetType: AssetType;
	Manufacturer: Contact;
	ModelNumber: STRING;
	Warranty: Warranty;
	ReplacementCost: OPTIONAL REAL;
	ExpectedLife: OPTIONAL REAL;
	DurationUnit: OPTIONAL DurationUnit;
	NominalLength: REAL;
	NominalWidth: REAL;
	NominalHeight: REAL;
	ModelReference: OPTIONAL STRING;
	Shape: OPTIONAL STRING;
	Size: OPTIONAL STRING;
	Color: OPTIONAL STRING;
	Finish: OPTIONAL STRING;
	Grade: OPTIONAL STRING;
	Material: OPTIONAL STRING;
	Constituents: OPTIONAL STRING;
	Features: OPTIONAL STRING;
	AccessibilityPerformance: OPTIONAL STRING;
	CodePerformance: OPTIONAL STRING;
	SustainabilityPerformance: OPTIONAL STRING;
	AssemblyOf: OPTIONAL LIST [1:?] OF @Type;
    Jobs: OPTIONAL LIST [0:?] OF Job;
  INVERSE
    Components: SET [0:?] OF Component FOR @Type;
    Spares: SET [0:?] OF Spare FOR @Type;
END_ENTITY;

ENTITY Warranty
	Description: OPTIONAL STRING;
	GuarantorParts: Contact;
	DurationParts: REAL;
	GuarantorLabor: Contact;
	DurationLabor: REAL;
	DurationUnit: DurationUnit;
END_ENTITY;

ENTITY Component
 SUBTYPE OF (Asset);
	SerialNumber: STRING;
	InstallationDate: DateTimeValue;
	WarrantyStartDate: DateTimeValue;
	TagNumber: OPTIONAL STRING;
	BarCode: OPTIONAL STRING;
	AssetIdentifier: OPTIONAL STRING;
	@Type: @Type;
	Space: Space;
	AssemblyOf: OPTIONAL LIST [1:?] OF Component;
  INVERSE
    InSystems: SET [0:?] OF System FOR Components;
    ConnectedBefore: SET [0:?] OF Connection FOR ComponentA;
    ConnectedAfter: SET [0:?] OF Connection FOR ComponentB;
    Connecting: SET [0:?] OF Connection FOR RealizingComponent;
END_ENTITY;

ENTITY System
 SUBTYPE OF (Asset);
	Components: LIST [1:?] OF Component;
END_ENTITY;

ENTITY Connection
  SUBTYPE OF (ReferencedObject);
    Name: STRING;
	Description: OPTIONAL STRING;
	ConnectionType: ConnectionType;
	ComponentA: Component;
	ComponentB: Component;
	RealizingComponent: OPTIONAL Component;
	PortNameA: OPTIONAL STRING;
	PortNameB: OPTIONAL STRING;
END_ENTITY;

ENTITY Spare
  SUBTYPE OF (ReferencedObject);
    Name: STRING;
	Description: OPTIONAL STRING;
	SpareType: SpareType;
	@Type: @Type;
	Suppliers: OPTIONAL LIST [0:?] OF Contact;
	SetNumber: OPTIONAL STRING;
	PartNumber: OPTIONAL STRING;
END_ENTITY;

ENTITY Resource
  SUBTYPE OF (ReferencedObject);
    Name: STRING;
	Description: OPTIONAL STRING;
	ResourceType: ResourceType;
END_ENTITY;

ENTITY Job
  SUBTYPE OF (ReferencedObject);
	TaskNumber: STRING;
    Name: STRING;
	Description: STRING;
	JobType: JobType;
	JobStatusType: JobStatusType;
	Duration: REAL;
	DurationUnit: DurationUnit;
	Start: REAL;
	StartUnit: DurationUnit;
	Frequency: REAL;
	FrequencyUnit: DurationUnit;
	Priors: Job;
	Resources: OPTIONAL LIST [0:?] OF Resource;
  INVERSE
    ForTypes: SET [1:?] OF @Type FOR Jobs;
END_ENTITY;

ENTITY Impact
  SUBTYPE OF (ReferencedObject);
    Name: STRING;
	Description: OPTIONAL STRING;
	ImpactType: ImpactType;
	ImpactStage: ImpactStage;
	Value: REAL;
	ImpactUnit: ImpactUnit;
	LeadInTime: REAL;
	Duration: REAL;
	LeadOutTime: REAL;
	DurationUnit: DurationUnit;
END_ENTITY;

ENTITY Document
  SUBTYPE OF (ReferencedObject);
    Name: STRING;
	Description: OPTIONAL STRING;
	DocumentType: DocumentType;
	ApprovalType: ApprovalType;
	Stage: StageType;
	URL: STRING;
	@Reference: OPTIONAL STRING;
END_ENTITY;

ENTITY Attribute
    Name: STRING;
	SetName : OPTIONAL STRING;
	Description: OPTIONAL STRING;
	Stage: StageType;
	Value: AttributeValue;
	Unit: OPTIONAL STRING;
	AllowedValues: OPTIONAL LIST [0:?] OF STRING;
END_ENTITY;

ENTITY Issue
  SUBTYPE OF (ReferencedObject);
    Name: STRING;
	Description: STRING;
	IssueType: IssueType;
	Risk: IssueRisk;
	Chance: IssueChance;
	Impact: IssueImpact;
	Owner: Contact;
	Mitigation: STRING;
	Causing: Asset;
	Affected: Asset;
END_ENTITY;

(*
  Pick values represent either classification or extendable enumeration of values.
  Different kinds of enumerations are represented by distinct types so it is possible
  so find all existing candidates if needed just by their type.
*)

ENTITY PickValue
	ABSTRACT SUPERTYPE;
	Value: STRING;
END_ENTITY;

ENTITY Category
  SUBTYPE OF (PickValue);
	Key: STRING;
END_ENTITY;

ENTITY Role
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY LinearUnit
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY AreaUnit
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY VolumeUnit
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY CurrencyUnit
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY DurationUnit
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY AssetType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY ConnectionType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY SpareType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY ResourceType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY JobType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY JobStatusType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY ImpactType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY ImpactStage
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY ImpactUnit
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY DocumentType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY StageType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY ApprovalType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY IssueType
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY IssueChance
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY IssueRisk
  SUBTYPE OF (PickValue);
END_ENTITY;

ENTITY IssueImpact
  SUBTYPE OF (PickValue);
END_ENTITY;

END_SCHEMA;